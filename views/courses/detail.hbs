{{#section 'css'}}
<link href="https://vjs.zencdn.net/7.10.2/video-js.css" rel="stylesheet" />
<style>
  /* course-intro */
  .course-detail {
    height: 32vw;
    background-color: #3659a2;
  }

  .course-detail-img {
    margin-top: 13%;
    border-radius: 6px;
    overflow: hidden;
  }

  .img-fluid {
    max-height: 350px;
    width: 100%;
    background-image: cover;
  }

  /* Tooltip custom */
  .tooltip-inner {
    background-color: #37294c;
  }

  .tooltip.bs-tooltip-right .arrow:before {
    display: none;
  }

  .tooltip.bs-tooltip-left .arrow:before {
    display: none;
  }

  .tooltip.bs-tooltip-bottom .arrow:before {
    display: none;
  }

  .tooltip.bs-tooltip-top .arrow:before {
    display: none;
  }

  /* Tab */
  .show {
    color: #37294c;
  }

  .nav-tabs .active {
    color: #f0f0f0 !important;
    background-color: #3659a2 !important;
    border-bottom: solid 5px !important;
  }

  .nav-tabs .active:hover {
    color: #ccc !important;
  }

  .nav-link {
    color: #f0f0f0;
    font-weight: 500;
  }

  .nav-tabs .nav-link {
    border: none;
  }

  .nav-link:hover {
    color: #ccc;
  }

  /* Tab content*/

  .tab-content {
    color: #37294c;
    width: 50%;
  }

  /* description */

  ul {
    list-style: none;
  }

  .tab-content .active {
    animation: fadeInLeft 0.7s;
  }

  @keyframes fadeInLeft {
    0% {
      opacity: 0;
      transform: translateX(-20px);
    }

    100% {
      opacity: 1;
      transform: translateX(0);
    }
  }

  .tab-pane>p,
  li {
    color: black;
  }

  /* Accordition */
  .accordion {
    background-color: white;
    color: #444;
    cursor: pointer;
    padding: 18px;
    width: 100%;
    border: none;
    text-align: left;
    outline: none;
    font-size: 15px;
    transition: 0.4s;
    border-radius: 6px;
    margin-top: 20px;
    box-shadow: rgba(100, 100, 111, 0.2) 0px 7px 29px 0px;
    font-size: large;
    font-weight: 500;
  }

  .accordion:focus {
    outline: 0px;
  }

  .acor-active {
    border-radius: 8px 8px 0 0;
    box-shadow: rgba(100, 100, 111, 0.2) 0px 0px 0px 0px;
  }

  .acor-active+.panel {
    border-radius: 0 0 8px 8px;
    box-shadow: rgba(100, 100, 111, 0.2) 0px 7px 29px 0px;
  }

  .accordion:after {
    content: "\f107";
    font-family: "Font Awesome 5 Free";
    color: #777;
    font-weight: bold;
    float: right;
    margin-left: 5px;
  }

  .acor-active:after {
    border: none;
    content: "\f106";
    font-family: "Font Awesome 5 Free";
  }

  .panel {
    padding: 0 18px;
    background-color: white;
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.2s ease-out;
  }

  .panel li {
    font-size: large;
    font-weight: 400;
    padding-left: 40px;
  }

  .panel li:before {
    content: "\f144";
    font-family: "Font Awesome 5 Free";
    position: relative;
    left: -20px;
  }

  /* Overlay */
  .overlay {
    position: relative;
  }

  .image-overlay {
    opacity: 1;
    display: block;
    width: 100%;
    height: auto;
    transition: 0.5s ease;
    backface-visibility: hidden;
  }

  .middle {
    transition: 0.5s ease;
    opacity: 0;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    -ms-transform: translate(-50%, -50%);
    text-align: center;
  }

  .overlay:hover .middle {
    opacity: 1;
  }

  .text {
    color: white;
    font-size: 100px;
  }

  iframe {
    display: block;
  }


  /* Instructor */
  .instructor-name {
    color: #3659a2;
  }

  .intructor-first-des {
    font-size: medium;
    font-weight: 600;
    color: #777 !important;
  }


  /* Progress */
  .progress {
    background-color: #ccc !important;
  }

  /* Feedback */
  .feedback-rating {
    width: 8.5rem;
    height: 8.5rem;
    overflow: hidden;
    border-radius: 7px;
    box-shadow: rgba(0, 0, 0, 0.24) 0px 3px 8px;
  }

  .review-image-div {
    width: 4rem;
    height: 4rem;
    overflow: hidden;
  }

  .review-image {
    height: 4rem;
    margin-left: 50%;
    transform: translateX(-50%);
  }

  .comment-content {
    font-weight: 600;
    font-size: 16px;
  }

  .comment-content>p {
    font-weight: 200;
    font-size: 15px;
    color: #777;
  }

  .number-rates {
    color: #8c8b8b;
    font-weight: 400;
    align-self: center;
  }

  .rate, .rateToSubmit {
    font-size: 25px;
    font-family: sans-serif;
    color: #ff8000;
    margin-left: 20px;
    margin-right: 20px;
  }
</style>
{{/section}}


<!-- info -->
<div class="container-fluid course-detail d-flex">
  <div class="mx-auto d-flex w-75">
    <div class="col-6 d-flex flex-column">
      <div class="p-0 overlay course-detail-img">
        <img class="img-fluid" src="{{course.thumbnail}}" alt="">
        <div class="middle">
          <div class="text my-auto"><a href="#course-video" data-toggle="modal" class="text-dark"><i
                class="fas fa-play"></i></a></div>
        </div>
      </div>
      <ul class="nav nav-tabs mt-auto border-0" role="tablist">
        <li class="nav-item">
          <a class="nav-link active" data-toggle="tab" href="#description">Description</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" data-toggle="tab" href="#curriculum">Curriculum</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" data-toggle="tab" href="#instructor">Instructor</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" data-toggle="tab" href="#feedback">Feedback</a>
        </li>
      </ul>
    </div>
    <div class="h-75 d-inline-block align-self-center ml-auto text-white" style="width: 45%;">
      <h3 class="font-weight-bold">{{course.name}}</h3>

      {{{course.short_description}}}

      <div class="d-flex text-warning mt-3">
        {{#ifgreater course.discount_price 0}}
        <h3 class="delete-price text-dark">${{course.price}}</h3>
        <h3 class="ml-4">${{course.discount_price}}</h3>
        {{else}}
        <h3 class="text-warning">${{course.price}}</h3>
        {{/ifgreater}}
        {{#ifequal role 1}}
        <h3 class="mx-auto"><a class="btn-wish" data-id="{{course._id}}" data-toggle="tooltip" data-placement="top"
            title="Add to Wishlist"><i class="fa-heart text-danger wish-icon"></i></a></i></h3>
        {{/ifequal}}
      </div>
      <div class="d-flex">
        <span class="number-rating bg-warning text-white px-2 h-75 align-self-center"
          style="border-radius: 5px;">4.6</span>
        <div class="rate" data-rate-value=4.6></div>
        <span class="number-rates"><i class="fas fa-users"></i> {{course.course_students.length}}</span>
      </div>
      <p class="mt-3">Created by <strong>{{course.course_author.name}}</strong> </p>
      <div class="d-flex">
        <p><i class="far fa-edit"></i> Last updated {{dateFormat course.updatedAt}} </p>
      </div>
      <button type="button" class="btn btn-add-cart btn-danger btn-lg w-40" data-id="{{course._id}}">Add to
        cart</button>
      <button type="button" class="btn-book-course btn btn-primary btn-lg ml-5 w-40" data-id="{{course._id}} ">Buy
        now</button>
    </div>
  </div>

</div>

<div class="container-fluid d-flex justify-content-center pt-4" style="background-color: #EDEFF0;">
  <div class="tab-content px-0">
    <div id="description" class="container tab-pane active"><br>
      <h3>Description</h3>
      {{{course.description}}}
    </div>
    <div id="curriculum" class="container tab-pane fade"><br>
    {{#ifCond isBooked '||' isTeacher}}
{{#each course.curriculum}}
      <button class="accordion">{{chapter_name}}</button>
      <div class="panel p-0">
        <ul class="list-group">
          {{#each this.lectures}}
          <a href="#{{_id}}" data-toggle="modal" style="text-decoration: none;">
            <li class="list-group-item list-group-item-action border-0">{{name}}</li>
          </a>
          {{/each}}
        </ul>
      </div>
      {{/each}}
    {{else}}
{{#each course.curriculum}}
      <button class="accordion">{{chapter_name}}</button>
      <div class="panel p-0">
        <ul class="list-group">
          {{#each this.lectures}}
            <li class="list-group-item list-group-item-action border-0">{{name}}
            {{#if this.preview}}
                <a href="#{{_id}}" data-toggle="modal"><span class="badge badge-success px-2 py-1 ml-2">
                Preview</span></a>
            {{/if}}
            </li>
          {{/each}}
        </ul>
      </div>

      {{/each}}
    {{/ifCond}}
      

    </div>
    <div id="instructor" class="container tab-pane fade"><br>
      <h3 class="instructor-name">{{course.course_author.name}}</h3>
      <p class="intructor-first-des">{{course.course_author.short_description}}</p>
      <div class="row">
        <img src="/public/images/avatars/avatar-2.jpeg" class="rounded-circle ml-2 mb-4" alt="">
        <div class="d-flex col-6">
          <div class="text-danger">
            <p><i class="fas fa-users"></i> </p>
            <p><i class="fas fa-play-circle"></i> </p>
            <p><i class="fas fa-user"></i> </p>
            <p><i class="fa fa-medal"></i> </p>
          </div>
          <div class="col-8">
            <p>6 Students</p>
            <p>20 Courses</p>
            <p>10 Years</p>
            <p>3 Certificates</p>
          </div>
        </div>
        {{{course.course_author.description}}}
      </div>
    </div>
    <div id="feedback" class="container tab-pane fade pl-0"><br>
      <h3>Student rates</h3>  
      <div class="row my-3 ml-1">
        <div class="d-flex flex-column align-items-center bg-light feedback-rating">
          <h1 class="mt-2 mb-0">{{course.rating}}</h1>
          <div class="rate text-dark" data-rate-value={{course.rating}}></div>
          <p class="mb-2">Course Rating</p>
        </div>
        <div class="col-7 d-flex flex-column justify-content-around">
          <div class="progress h-10">
            <div class="progress-bar" role="progressbar" id="pb5" style="width: 100%"></div>
          </div>
          <div class="progress h-10">
            <div class="progress-bar" role="progressbar" id="pb45" style="width: 90%"></div>
          </div>
          <div class="progress h-10">
            <div class="progress-bar" role="progressbar" id="pb4" style="width: 80%"></div>
          </div>
          <div class="progress h-10">
            <div class="progress-bar" role="progressbar" id="pb35" style="width: 70%"></div>
          </div>
          <div class="progress h-10">
            <div class="progress-bar" role="progressbar" id="pblqt3" style="width: 2%"></div>
          </div>
        </div>
        <div class="col d-flex flex-column justify-content-around">
          <div class="d-flex">
            <span class="align-self-center mr-2" id="_5">40% voted </span>            
            <span class="align-self-center">5 <i class="fas fa-star text-warning"></i></span>
          </div>
          <div class="d-flex">
              <span class="align-self-center mr-2" id="_45">40% voted </span>           
            <span class="align-self-center">4.5 <i class="fas fa-star text-warning"></i></span>
          </div>
          <div class="d-flex">
              <span class="align-self-center mr-2" id="_4">40% voted </span>            
            <span class="align-self-center">4 <i class="fas fa-star text-warning"></i></span>
          </div>
          <div class="d-flex">
              <span class="align-self-center mr-2" id="_35">40% voted </span>
            <span class="align-self-center">3.5 <i class="fas fa-star text-warning"></i></span>
          </div>
          <div class="d-flex">
            <span class="align-self-center mr-2" id="_lqt3">40% voted </span>
            <span class="align-self-center">â‰¤ 3 <i class="fas fa-star text-warning"></i></span>
          </div>
        </div>
      </div>
      <h3>Reviews</h3>
      {{#if course.rates}}
      <ul class="p-0 my-4">
        {{#each course.rates}}
        <li>
          <div class="d-flex">
            <div class="rounded-circle review-image-div">
            <img src="{{student_avatar}}" class="review-image">
            </div>
            <div class="col-8 comment-content">
              {{student_name}}
              <p>Student</p>
            </div>
            <div class='rate' data-rate-value={{rate_value}}></div>
          </div>
          <div class="offset-1 col-11 mt-2">
            <p>{{comment}}</p>
          </div>
        </li>
        <br>
        {{/each}}
      </ul>
      {{else}}
          <h5>No one has rated this course</h5>
      {{/if}}
      <h3>Submit reviews</h3>
      <form action="/courses/rate/{{course.slug}}" method="POST" id="feedback_submit">
      <div class="my-4">
          
        <div class="d-flex">
            <div class="rounded-circle review-image-div">
            <img src="{{user.avatar}}" class="review-image">
            </div>
            <div class="col-5 comment-content">
              {{user.name}}
              <p>Student</p>
            </div>
            <div class="col"> Pick your star rated for this course:</div>
            <div class='rateToSubmit'></div>
            <input type="hidden" id="rate_value" name="rate_value" value='0'>
          </div>
          <div class="offset-1 col-11 mt-2 form-group">
            <label for="comment">Comment</label>
            <textarea class="form-control" id="comment" name="comment"></textarea>
          </div>
          <div class="offset-10">
          <button class="btn btn-primary" type="submit" id="btn-submit">Update feedback</button>
          </div>
      </div>
      </form>
    </div>
  </div>

  <div class="col-3 pt-4">
    <h3 class="mb-3 d-block w-75" style="color: #3E416D;margin-left:32px;">Related courses</h3>
    <div class="row d-flex flex-column align-items-center p-0 b-5">
      <div class="p-0 mb-5 col-9">
        <div class="card h-100">
          <img class="card-img-top" src="/public/images/courses/1.png" alt="Card image cap">
          <div class="card-body d-flex flex-column">
            <p class="card-text text-primary font-weight-bold">Web Development</p>
            <h6 class="card-title font-weight-bold">Ultimate Web Developer Course </h6>
            <p class="card-subtitle text-secondary teacher-text">Ho Tuan Thanh</p>
            <div class="_43">
              <span class="number-rating"></span>
              <div class="stars-outer">
                <div class="stars-inner"></div>
              </div>
              <span class="number-rates">(40.323)</span>
            </div>
            <div class="d-flex">
              <h5 class="card-text font-weight-bold delete-price"> $200 </h5>
              <h5 class="card-text font-weight-bold align ml-3"> $199.99 </h5>
            </div>
            <a href="#" class="btn btn-primary align-self-start mt-auto">Go to course</a>
          </div>
        </div>
      </div>
      <div class="p-0 mb-5 col-9">
        <div class="card h-100">
          <img class="card-img-top" src="/public/images/courses/2.png" alt="Card image cap">
          <div class="card-body d-flex flex-column">
            <p class="card-text text-primary font-weight-bold">Web Development</p>
            <h6 class="card-title font-weight-bold">Learn Angular Fundamentals </h5>
              <p class="card-subtitle text-secondary teacher-text">Nguyen Duc Huy</p>
              <div class="_44">
                <span class="number-rating"></span>
                <div class="stars-outer">
                  <div class="stars-inner"></div>
                </div>
                <span class="number-rates">(41.543)</span>
              </div>
              <h5 class="card-text font-weight-bold"> $99.99 </h5>
              <a href="#" class="btn btn-primary align-self-start mt-auto">Go to course</a>
          </div>
        </div>
      </div>
      <div class="p-0 mb-5 col-9">
        <div class="card h-100">
          <img class="card-img-top" src="/public/images/courses/3.png" alt="Card image cap">
          <div class="card-body d-flex flex-column">
            <p class="card-text text-primary font-weight-bold">JavaScript</p>
            <h6 class="card-title font-weight-bold">The Complete JavaScript </h5>
              <p class="card-subtitle text-secondary teacher-text">Ngo Ngoc Dang Khoa</p>
              <div class="_46">
                <span class="number-rating"></span>
                <div class="stars-outer">
                  <div class="stars-inner"></div>
                </div>
                <span class="number-rates">(40.686)</span>
              </div>
              <h5 class="card-text font-weight-bold"> $111.99 </h5>
              <a href="#" class="btn btn-primary align-self-start mt-auto">Go to course</a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


<!-- Modal -->
<div class="modal fade" id="course-video" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content m-0" style="width: 608px;">
      <div class="modal-header">
        <div>
          <h6 class="modal-title" id="exampleModalLongTitle">Courses Preview</h6>
          <h4 class="model-title"> {{course.name}}</h4>
        </div>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body p-0">
        <video id="my-video" class="video-js" controls preload="auto" width="608" height="342" data-setup="{}">
          <source src="{{course.preview_video}}" type="video/mp4" />
          <source src="MY_VIDEO.webm" type="video/webm" />
          <p class="vjs-no-js">
            To view this video please enable JavaScript, and consider upgrading to a
            web browser that
            <a href="https://videojs.com/html5-video-support/" target="_blank">supports HTML5 video</a>
          </p>
        </video>
      </div>
    </div>
  </div>
</div>

{{#each course.curriculum}}
{{#each this.lectures}}
{{#ifCond link '===' ''}}
<div class="modal fade" id="{{_id}}" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content m-0" style="width: 608px;">
      <div class="modal-header">
        <div>
          <h4 class="modal-title" id="exampleModalLongTitle">{{name}}</h4>
        </div>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body p-0">
        <h5> Video cua bai giang nay chua duoc dang</h5>
        {{{description}}}
      </div>
    </div>
  </div>
</div>
{{else}}
<div class="modal fade" id="{{_id}}" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content m-0" style="width: 608px;">
      <div class="modal-header">
        <div>
          <h4 class="modal-title" id="exampleModalLongTitle">{{name}}</h4>
        </div>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body p-0">
        <video id="my-video" class="video-js" controls preload="auto" width="608" height="342" data-setup="{}">
          <source src="{{link}}" type="video/mp4" />
          <source src="MY_VIDEO.webm" type="video/webm" />
          <p class="vjs-no-js">
            To view this video please enable JavaScript, and consider upgrading to a
            web browser that
            <a href="https://videojs.com/html5-video-support/" target="_blank">supports HTML5 video</a>
          </p>
        </video>

        {{{description}}}
      </div>
    </div>
  </div>
</div>
{{/ifCond}}
{{/each}}
{{/each}}



<form name="book-course" method="POST"></form>
<form name="wish-course" method="POST"></form>
<form name="add-course" method="POST"></form>


{{#section 'js'}}
<script src="https://vjs.zencdn.net/7.10.2/video.min.js"></script>
<script>
  $(document).ready(function () {
    var url = $("#Geeks3").attr('src');
    $("#Geeks2").on('hide.bs.modal', function () {
      $("#Geeks3").attr('src', '');
    });
    $("#Geeks2").on('show.bs.modal', function () {
      $("#Geeks3").attr('src', url);
    });
  });

  $(document).ready(function () {
    var options = {
      max_value: 5,
      initial_value: 4,
      readonly: true
    }
    $(".rate").rate(options);

    var optionsForSubmit = {
      max_value: 5,
      step_size: 0.5,
      initial_value: 0,
    }
    $(".rateToSubmit").rate(optionsForSubmit);
  });

  {{#ifequal role 1}}
  function isWished() {
    var heart = $('.btn-wish').data('id');
    return $.getJSON(`/courses/wished?id=${heart}`);
  }

  $(document).ready(function () {
    $('[data-toggle="tooltip"]').tooltip();
    isWished().then(wished => {
      let wishIcon = $('.wish-icon');
      console.log(wished);
      if (wished)
        wishIcon.addClass('fas');
      else
        wishIcon.addClass('far');
    });
  });
  {{/ifequal}}

      //Accordition
      var acc = document.getElementsByClassName("accordion");
      var i;

      for (i = 0; i < acc.length; i++) {
        acc[i].addEventListener("click", function () {
          this.classList.toggle("acor-active");
          var panel = this.nextElementSibling;
          if (panel.style.maxHeight) {
            panel.style.maxHeight = null;
          } else {
            panel.style.maxHeight = panel.scrollHeight + "px";
          }
        });
      }

      {{#ifequal role 1 }}
      var bookForm = document.forms['book-course'];
      var btnBook = $('.btn-book-course');
      btnBook.on('click', function () {
        bookForm.action = '/courses/book/' + btnBook.data('id');
        bookForm.submit();
      })

      var addForm = document.forms['add-course'];
      var btnAdd = $('.btn-add-cart');
      btnAdd.on('click', function () {
        addForm.action = '/courses/add/' + btnAdd.data('id');
        addForm.submit();
      })

      var feedbackForm= document.forms['feedback_submit'];
      var btnSubmit = $('#btn-submit');
      btnSubmit.on('click', function () {
        let rate_val=$('.rateToSubmit').rate("getValue");
        $('input[name=rate_value]').val(rate_val);
        feedbackForm.submit();
      })

      var wishForm = document.forms['wish-course'];
      var btnWish = $('.btn-wish');
      btnWish.on('click', function () {
        isWished().then(wished => {
          let wishIcon = $('.wish-icon');
          if (wished === true) {
            wishIcon.removeClass('fas');
            wishIcon.addClass('far');
            $.post('/courses/wish/' + btnWish.data('id'), $('.btn-wish').serialize());
          }
          else {
            wishIcon.removeClass('far');
            wishIcon.addClass('fas');
            $.post('/courses/wish/' + btnWish.data('id'), $('.btn-wish').serialize());
          }
        });
      });
      {{/ifequal}}

      var rate5=0,rate45=0,rate4=0,rate35=0,ratelqt3=0;
      {{#each course.rates}}
        {{#ifequal rate_value '5'}}
            rate5++;
        {{else}}
        {{#ifequal rate_value '4.5'}}
            rate45++;
        {{else}}
        {{#ifequal rate_value '4'}}
            rate4++;
        {{else}}
        {{#ifequal rate_value '3.5'}}
            rate35++;
        {{else}}
            ratelqt3++;
        {{/ifequal}}
        {{/ifequal}}
        {{/ifequal}}
        {{/ifequal}}
      {{/each}}
      var len={{course.rates.length}};

      $('#_5').html(rate5+' voted ');
      $('#_45').html(rate45+' voted ');
      $('#_4').html(rate4+' voted ');
      $('#_35').html(rate35+' voted ');
      $('#_lqt3').html(ratelqt3+' voted ');
      $('#pb5').width((rate5*100)/len+'%');
      $('#pb45').width((rate45*100)/len+'%');
      $('#pb4').width((rate4*100)/len+'%');
      $('#pb35').width((rate35*100)/len+'%');
      $('#pblqt3').width((ratelqt3*100)/len+'%');
</script>
{{/section}}